# Skillset (chunk + Azure OpenAI embedding)
PUT https://{{searchServiceName}}.search.windows.net/skillsets/sp-vector-skillset?api-version={{searchApiVersion}}
api-key: {{searchAdminKey}}
Content-Type: application/json

{
  "name": "sp-vector-skillset",
  "cognitiveServices": {
    "@odata.type": "#Microsoft.Azure.Search.AIServicesByIdentity",
    "description": "A sample configuration for a system-assigned managed identity.",
    "subdomainUrl": "https://<{AI Foundry Name}>.services.ai.azure.com",
    "identity": null
  },
  "skills": [
    {
      "@odata.type": "#Microsoft.Skills.Vision.OcrSkill",
      "name": "#ocr",
      "description": "Extract text from scanned PDFs and images",
      "context": "/document/normalized_images/*",
      "defaultLanguageCode": "en",
      "detectOrientation": true,
      "inputs": [
        { "name": "image", "source": "/document/normalized_images/*" }
      ],
      "outputs": [
        { "name": "text", "targetName": "text" }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.MergeSkill",
      "name": "#merge",
      "description": "Merge OCR text with extracted content",
      "context": "/document",
      "insertPreTag": " ",
      "insertPostTag": " ",
      "inputs": [
        { "name": "text", "source": "/document/content" },
        { "name": "itemsToInsert", "source": "/document/normalized_images/*/text" }
      ],
      "outputs": [
        { "name": "mergedText", "targetName": "merged_content" }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.SplitSkill",
      "name": "#split",
      "description": "Split merged content into chunks to avoid token limit",
      "context": "/document",
      "textSplitMode": "pages",
      "maximumPageLength": 2000,
      "pageOverlapLength": 200,
      "inputs": [
        { "name": "text", "source": "/document/merged_content" }
      ],
      "outputs": [
        { "name": "textItems", "targetName": "pages" }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.AzureOpenAIEmbeddingSkill",
      "name": "#embed-content",
      "description": "Generate embeddings for each chunk",
      "context": "/document/pages/*",
      "resourceUri": "{{aoaiEndpoint}}",
      "deploymentId": "{{aoaiDeploymentId}}",
      "modelName": "{{aoaiModelName}}",
      "apiKey": "{{aoaiApiKey}}",
      "inputs": [
        { "name": "text", "source": "/document/pages/*" }
      ],
      "outputs": [
        { "name": "embedding", "targetName": "vector" }
      ]
    }
  ]
}